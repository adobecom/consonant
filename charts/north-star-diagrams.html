<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Adobe DS North Star — Team Org + Lifecycle</title>

    <!-- D3 + Dagre-D3 (layout engine) -->
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdn.jsdelivr.net/npm/dagre@0.8.5/dist/dagre.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dagre-d3@0.6.4/dist/dagre-d3.min.js"></script>

    <style>
      :root {
        --bg: #0b0d12;
        --panel: #0f1420;
        --card: #111827;
        --muted: #9aa4b2;
        --text: #e5e7eb;
        --stroke: #2b3445;
        --accent: #60a5fa;
        --good: #34d399;
        --warn: #fbbf24;
        --bad: #fb7185;
      }

      html,
      body {
        height: 100vh;
        width: 100vw;
        margin: 0;
        padding: 0;
        overflow: hidden;
        max-width: none;
        box-sizing: border-box;
        background: var(--bg);
        color: var(--text);
        font-family:
          ui-sans-serif,
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Helvetica,
          Arial;
      }
      * {
        box-sizing: border-box;
      }
      .wrap {
        width: 100vw;
        height: 100vh;
        max-width: none;
        display: grid;
        grid-template-columns: 1.3fr 0.7fr;
        gap: 16px;
        padding: 16px;
        box-sizing: border-box;
        margin: 0;
      }
      .wrap.right-collapsed {
        grid-template-columns: 1fr;
        padding: 0;
        gap: 0;
        width: 100vw;
        max-width: none;
      }

      .left {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.04),
          rgba(255, 255, 255, 0.02)
        );
        border: 1px solid var(--stroke);
        border-radius: 14px;
        overflow: hidden;
        position: relative;
        width: 100%;
        height: 100%;
        max-width: none;
        min-width: 0;
      }
      .wrap.right-collapsed .left {
        border-radius: 0;
        border-left: none;
        border-right: none;
        border-top: none;
        width: 100vw;
      }

      .toolbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 14px;
        border-bottom: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.02);
        gap: 12px;
        flex-wrap: wrap;
      }

      .title {
        display: flex;
        flex-direction: column;
        gap: 4px;
        min-width: 280px;
      }
      .title h1 {
        font-size: 14px;
        margin: 0;
        letter-spacing: 0.2px;
      }
      .title p {
        font-size: 12px;
        margin: 0;
        color: var(--muted);
      }

      .tabs {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }
      .tab {
        appearance: none;
        border: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.02);
        color: var(--text);
        padding: 8px 10px;
        border-radius: 10px;
        font-size: 12px;
        cursor: pointer;
      }
      .tab.active {
        border-color: rgba(96, 165, 250, 0.85);
        box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.15) inset;
      }

      .btns {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        margin-left: auto;
      }
      button.action {
        appearance: none;
        border: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.02);
        color: var(--text);
        padding: 8px 10px;
        border-radius: 10px;
        font-size: 12px;
        cursor: pointer;
      }
      button.action:hover {
        border-color: rgba(96, 165, 250, 0.8);
      }

      .svgWrap {
        position: absolute;
        inset: 58px 0 0 0;
        overflow: auto;
        width: 100%;
        height: 100%;
      }

      /* Right panel */
      .right {
        background: var(--panel);
        border: 1px solid var(--stroke);
        border-radius: 14px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }
      .rightHeader {
        padding: 12px 14px;
        border-bottom: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.02);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }
      .rightHeaderContent {
        flex: 1;
      }
      .toggleBtn {
        appearance: none;
        border: 1px solid var(--stroke);
        background: rgba(255, 255, 255, 0.02);
        color: var(--text);
        padding: 6px 10px;
        border-radius: 8px;
        font-size: 12px;
        cursor: pointer;
        flex-shrink: 0;
      }
      .toggleBtn:hover {
        border-color: rgba(96, 165, 250, 0.8);
      }
      .right.collapsed {
        display: none;
      }
      .rightHeader h2 {
        margin: 0;
        font-size: 14px;
      }
      .rightHeader p {
        margin: 6px 0 0;
        font-size: 12px;
        color: var(--muted);
      }

      .card {
        padding: 14px;
        overflow: auto;
      }
      .card h3 {
        margin: 0 0 6px;
        font-size: 16px;
      }
      .pillRow {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        margin: 8px 0 12px;
      }
      .pill {
        font-size: 11px;
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid var(--stroke);
        color: var(--muted);
        background: rgba(255, 255, 255, 0.02);
      }
      .pill.accent {
        border-color: rgba(96, 165, 250, 0.6);
        color: rgba(96, 165, 250, 0.95);
      }
      .pill.good {
        border-color: rgba(52, 211, 153, 0.6);
        color: rgba(52, 211, 153, 0.95);
      }
      .pill.warn {
        border-color: rgba(251, 191, 36, 0.6);
        color: rgba(251, 191, 36, 0.95);
      }

      .section {
        margin-top: 14px;
        padding-top: 12px;
        border-top: 1px dashed rgba(255, 255, 255, 0.12);
      }
      .section h4 {
        margin: 0 0 8px;
        font-size: 12px;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }
      ul {
        margin: 0 0 0 18px;
        padding: 0;
        line-height: 1.5;
        font-size: 13px;
        color: var(--text);
      }
      li {
        margin: 6px 0;
      }

      /* Graph styling */
      svg {
        width: 100%;
        height: 100%;
      }
      .node rect {
        rx: 12px;
        ry: 12px;
        fill: rgba(255, 255, 255, 0.03);
        stroke: rgba(255, 255, 255, 0.16);
        stroke-width: 1.3px;
      }
      .node.selected rect {
        stroke: rgba(96, 165, 250, 0.95);
        stroke-width: 2.4px;
      }
      .node text {
        fill: var(--text);
        font-weight: 650;
        font-size: 12px;
      }
      .edgePath path {
        stroke: rgba(255, 255, 255, 0.22);
        stroke-width: 1.4px;
        fill: none;
      }
      .edgeLabel text {
        fill: rgba(255, 255, 255, 0.6);
        font-size: 10px;
      }
      .dashed path {
        stroke-dasharray: 6 5;
        opacity: 0.95;
      }
      .strong path {
        stroke: rgba(96, 165, 250, 0.55);
        stroke-width: 2px;
      }
      .success path {
        stroke: rgba(52, 211, 153, 0.55);
        stroke-width: 2px;
      }
      .warn path {
        stroke: rgba(251, 191, 36, 0.55);
        stroke-width: 2px;
      }

      .legend {
        position: absolute;
        right: 12px;
        bottom: 10px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid var(--stroke);
        background: rgba(0, 0, 0, 0.35);
        backdrop-filter: blur(6px);
        font-size: 11px;
        color: var(--muted);
        max-width: 520px;
      }
      .dot {
        width: 10px;
        height: 10px;
        border-radius: 999px;
        display: inline-block;
        margin-right: 6px;
      }
      .dot.a {
        background: rgba(96, 165, 250, 0.8);
      }
      .dot.b {
        background: rgba(255, 255, 255, 0.35);
      }
      .dot.c {
        background: transparent;
        border: 1px dashed rgba(255, 255, 255, 0.45);
      }

      @media (max-width: 1100px) {
        .wrap {
          grid-template-columns: 1fr;
        }
        svg {
          width: 1400px;
          height: 980px;
        }
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <div class="left">
        <div class="toolbar">
          <div class="title">
            <h1 id="viewTitle">North Star Team Org + Agentic Workflow</h1>
            <p id="viewSub">
              Click a node to see responsibilities + how AI/MCP/automation is
              leveraged.
            </p>
          </div>

          <div class="tabs">
            <button class="tab active" id="tabOrg">Team Org</button>
            <button class="tab" id="tabLifecycle">Product Lifecycle</button>
          </div>

          <div class="btns">
            <button class="action" id="btnCenter">Center view</button>
            <button class="action" id="btnReset">Reset selection</button>
            <button id="togglePanel" class="toggleBtn" title="Toggle panel">Panel</button>
          </div>
        </div>

        <div class="svgWrap">
          <svg id="svg">
            <g id="g"></g>
          </svg>
        </div>

        <div class="legend">
          <span><span class="dot a"></span>Strong ownership / direction</span>
          <span><span class="dot b"></span>Collaboration / handoff</span>
          <span><span class="dot c"></span>Dotted = governance/influence</span>
        </div>
      </div>

      <div class="right" id="rightPanel">
        <div class="rightHeader">
          <div class="rightHeaderContent">
            <h2 id="panelTitle">Details</h2>
            <p id="panelSubtitle">Select a node in the diagram.</p>
          </div>
        </div>
        <div class="card" id="panel"></div>
      </div>
    </div>

    <script>
      // -----------------------------
      // View 1: TEAM ORG + AGENTIC WORKFLOW
      // -----------------------------
      const orgNodes = {
        architect: {
          title: "Architect",
          pills: [
            "Web dev expert",
            "Design systems expert",
            "Automation-first",
          ],
          owns: [
            "Expert in both web development and design system design — bridges technical implementation and design patterns",
            "Defines system-of-record: Tokens product + Component/Block Specs product",
            "Architects pipelines (token export/build/distribution) + spec schema + generators",
            "Sets guardrails for agentic workflows (AI prompts, validation gates, deterministic outputs)",
            "Runs governance: decisions, deprecations, migrations, release policy",
          ],
          leverages: [
            "Uses MCP + Cursor/Claude to draft specs, migration maps, and doc scaffolds (strict validation)",
            "Automates repetitive work: spec linting, token coverage reports, artifact generation, changelogs",
            "Maintains compiler mindset: Milo/Figma/docs are outputs, not sources of truth",
          ],
          outputs: [
            "Versioned Tokens product + releases",
            "Versioned Specs product (YAML/JSON)",
            "Generators (Figma-assisted componentization, Milo scaffolds, Storybook, Docs, Tag Manifest)",
          ],
        },

        uxScaling: {
          title: "Consonant UX Scaling (Systemization)",
          pills: ["System-ready design", "Normalization", "Decision log"],
          owns: [
            "Scales MVP into a system candidate (still design exploration — not yet componentized)",
            "Inventories variants across redesign (and existing surfaces) and collapses near-duplicates",
            "Defines variant axes + essential states + responsive completeness",
            "Captures authoring/content rules + fallbacks; maintains decision log + rationale",
          ],
          leverages: [
            "AI-assisted variant discovery & clustering (find all button-like instances, group deltas vs noise)",
            "AI drafts requirements/rationale + spec checklists; humans decide what becomes site-wide",
            "Token gap detection: identify where semantic tokens are missing and propose additions",
          ],
          outputs: [
            "Stage 2 system-ready design spec package",
            "Variant axes + constraints + state completeness + authoring intent",
            "Decision log (what’s kept/cut/adjusted and why)",
          ],
        },

        dsDesigners: {
          title: "Design System Designers (UX / Visual)",
          pills: ["Intent", "Patterns", "Figma authoring"],
          owns: [
            "Define design intent, interaction states, pattern rules, component anatomy (system view)",
            "Author Figma components using Variables (no hard-coded values)",
            "Validate reference outputs match intent (Figma + Storybook + Milo parity)",
          ],
          leverages: [
            "Use AI to draft usage guidelines, do/don’t examples, edge-case checklists",
            "Use MCP to validate alignment: specs/tokens/variants coverage and drift detection",
          ],
          outputs: [
            "Canonical pattern decisions and system rules",
            "Inputs for specs (anatomy/variants/constraints) and token semantics",
          ],
        },

        designEngineers: {
          title: "Design Engineers (Bridge: design ↔ code)",
          pills: ["Bridge role", "Implementation", "Storybook"],
          owns: [
            "Implement components/blocks from specs (Milo target today: HTML/CSS/JS)",
            "Build Storybook/reference implementations to document API + states",
            "Write tests and a11y checks; partner with platform for integration",
          ],
          leverages: [
            "Use Cursor/Claude for scaffold generation from specs (stories, tests, boilerplate)",
            "Use MCP to pull design/spec context and accelerate implementation with guardrails",
            "Automate matrix coverage: ensure all variants/states are represented and tested",
          ],
          outputs: [
            "Milo block implementations aligned to contracts",
            "Storybook stories + reference behaviors + test matrix",
          ],
        },

        miloPlatform: {
          title: "Milo / Platform Engineers (Runtime + integration)",
          pills: ["Runtime", "Performance", "Integration"],
          owns: [
            "Own runtime constraints: performance, security, bundling, release mechanics",
            "Integrate DS outputs into production workflows (consumption patterns + hooks)",
            "Provide extension points so spec-driven outputs land cleanly",
          ],
          leverages: [
            "Automate compatibility checks (perf budgets, integration tests)",
            "Use AI for migration assistance and code review acceleration (not as source of truth)",
          ],
          outputs: [
            "Reliable runtime substrate for blocks and token consumption",
            "Integration pathways for DS outputs to ship safely",
          ],
        },

        docsDevEx: {
          title: "Docs / DevEx (Publishing + IA)",
          pills: ["Docs", "DX", "Enablement"],
          owns: [
            "Own documentation IA and publishing workflows",
            "Ensure docs are generated from contracts and remain current",
            "Build contributor guides and adoption playbooks",
          ],
          leverages: [
            "Use AI to draft docs from spec fields (usage, examples, FAQs) with human review",
            "Automate doc freshness: docs update on token/spec release",
          ],
          outputs: [
            "Docs site generated from contracts (props/variants/tokens/a11y)",
            "Onboarding + contributor workflows",
          ],
        },

        a11y: {
          title: "Accessibility DRI (Requirements + gates)",
          pills: ["A11y", "Compliance", "Gates"],
          owns: [
            "Define accessibility requirements per component/block (ARIA, keyboard, focus, contrast)",
            "Establish gates (a11y tests, checklists, sign-offs) tied to releases",
          ],
          leverages: [
            "Automate a11y checks (Playwright/axe) and surface failures early",
            "Use AI to draft test cases/checklists, then enforce via deterministic tooling",
          ],
          outputs: [
            "A11y contracts inside specs + enforcement in CI",
            "Consistent compliance guidance across teams",
          ],
        },
      };

      const orgEdges = [
        {
          from: "architect",
          to: "uxScaling",
          label: "sets system direction",
          cls: "strong",
        },
        {
          from: "architect",
          to: "dsDesigners",
          label: "defines design contract",
          cls: "strong",
        },
        {
          from: "architect",
          to: "designEngineers",
          label: "defines build contract",
          cls: "strong",
        },
        {
          from: "architect",
          to: "miloPlatform",
          label: "aligns integration",
          cls: "strong",
        },
        {
          from: "architect",
          to: "docsDevEx",
          label: "drives doc automation",
          cls: "strong",
        },
        {
          from: "architect",
          to: "a11y",
          label: "defines gates",
          cls: "strong",
        },

        // Stage collaboration path
        {
          from: "uxScaling",
          to: "dsDesigners",
          label: "system-ready design spec",
          cls: "",
        },
        {
          from: "dsDesigners",
          to: "designEngineers",
          label: "spec + intent",
          cls: "",
        },
        {
          from: "designEngineers",
          to: "miloPlatform",
          label: "integration",
          cls: "",
        },

        // Influence/governance
        {
          from: "docsDevEx",
          to: "uxScaling",
          label: "doc IA inputs",
          cls: "dashed",
        },
        {
          from: "docsDevEx",
          to: "dsDesigners",
          label: "content alignment",
          cls: "dashed",
        },
        { from: "a11y", to: "uxScaling", label: "requirements", cls: "dashed" },
        {
          from: "a11y",
          to: "dsDesigners",
          label: "requirements",
          cls: "dashed",
        },
        {
          from: "a11y",
          to: "designEngineers",
          label: "test expectations",
          cls: "dashed",
        },
      ];

      // -----------------------------
      // View 2: PRODUCT LIFECYCLE / WORKFLOW
      // -----------------------------
      const lifeNodes = {
        stage1: {
          title: "Stage 1 — MVP (Feature UX / Redesign)",
          pills: ["Track 2/3 driver", "Context-first", "Fast iteration"],
          owns: [
            "Solve the redesign need in one context (control/challenger as needed)",
            "Capture intent: goal, content model, core states, responsive intent",
            "Use semantic tokens where possible; note raw values + rationale if not",
          ],
          leverages: [
            "AI drafts checklists (states, edge cases, content variability) from comps",
            "MCP helps discovery: existing patterns/tokens, prior art, constraints",
          ],
          outputs: [
            "MVP design package",
            "Initial requirements + constraints",
            "Clear definition of what is ‘test/MVP only’ vs candidate for scale",
          ],
        },

        gate12: {
          title: "Gate — Does this need to scale beyond MVP?",
          pills: ["Decision", "Scope", "Rationale"],
          owns: [
            "Decide: MVP only vs graduate to system candidate",
            "Document who requested what and why (site-wide vs team-specific)",
            "Avoid variant explosion: push back on one-offs",
          ],
          leverages: [
            "AI can summarize stakeholder asks into structured requirements",
            "Automation can flag duplicates (similar patterns already exist)",
          ],
          outputs: [
            "Decision log entry",
            "Scaling scope approved (or declined)",
          ],
        },

        stage2: {
          title: "Stage 2 — UX Scaling (Consonant UX Scaling)",
          pills: ["System-ready design", "Normalization", "Decision log"],
          owns: [
            "Inventory all variants across redesign (and ideally wider adobe.com surfaces)",
            "Define variant axes, essential states, responsive completeness",
            "Define authoring intent: required fields, fallbacks, content rules",
            "Accessibility checks at design level (contrast, targets, semantics intent)",
            "Maintain decision log: kept/cut/adjusted with rationale",
          ],
          leverages: [
            "Variant discovery + clustering (find all instances, group deltas vs noise)",
            "Draft structured spec artifacts (axes/state checklist/content rules) with AI assistance",
            "Token gap detection: propose semantic/component tokens needed",
          ],
          outputs: [
            "System-ready design spec package (still not yet componentized)",
            "Variant + state matrices (design-side)",
            "Authoring/content rules + constraints",
          ],
        },

        stage3: {
          title: "Stage 3 — System Spec + Build (DS Builders → Milo)",
          pills: ["Contract", "Production-ready", "Repeatable releases"],
          owns: [
            "Formalize build-ready spec: anatomy/slots, props, variants, constraints",
            "Full token mapping (no raw values) + a11y acceptance criteria",
            "Implement Milo block(s) and reference builds (Storybook) from the contract",
            "Add tests: unit + a11y + regression hooks",
          ],
          leverages: [
            "Cursor/Claude scaffold generation from specs (code, stories, tests, docs stubs)",
            "Automation gates: schema validation, token existence, invalid combos",
            "MCP accelerates implementation with consistent context + guardrails",
          ],
          outputs: [
            "Component/Block Spec v0.1 (YAML/JSON)",
            "Milo block implementation",
            "Storybook reference + tests",
            "Docs generated from contract",
          ],
        },

        authoring: {
          title: "Authoring Contract — Tags as First-Class",
          pills: ["Sidekick", "Manifest", "Legacy compat"],
          owns: [
            "Generate Tag Manifest from specs (tag → block + axes/values)",
            "Feed Sidekick Tag Selector/presets to avoid memorization",
            "Keep legacy tags working via compatibility mappings",
          ],
          leverages: [
            "Automation generates manifest on release",
            "AI can suggest correct tags/presets based on content intent",
          ],
          outputs: [
            "Tag Manifest (machine/doc/AI-readable)",
            "Improved author UX (searchable selection, constrained combos)",
          ],
        },

        tokens: {
          title: "Tokens as Product (Primitives → Semantics → Component)",
          pills: ["Versioned", "Validated", "Distributed"],
          owns: [
            "Token taxonomy + naming + modes/themes governance",
            "Exports from Figma → transforms → CSS custom properties (Milo consumption)",
            "CI validation + changelog + release process",
          ],
          leverages: [
            "Automation validates modes complete and prevents breaking changes",
            "AI assists mapping old → new names and drafting migration notes",
          ],
          outputs: [
            "Token bundles: CSS vars + JSON + optional typed maps",
            "Versioned releases consumed by Milo and other surfaces",
          ],
        },

        outputs: {
          title: "Outputs / Consumption",
          pills: ["Milo", "Docs", "Reference"],
          owns: [
            "Milo consumes token bundles; blocks render production UI",
            "Docs stay fresh from contract fields",
            "Storybook/reference builds provide code-side truth for APIs/states",
          ],
          leverages: [
            "Automation keeps artifacts in sync with releases",
            "AI drafts doc prose; humans review for accuracy",
          ],
          outputs: [
            "Production-ready blocks",
            "Always-current documentation",
            "Reduced drift across design/code/authoring",
          ],
        },
      };

      const lifeEdges = [
        { from: "stage1", to: "gate12", label: "submit MVP package", cls: "" },
        {
          from: "gate12",
          to: "stage2",
          label: "yes → scale it",
          cls: "success",
        },
        {
          from: "gate12",
          to: "outputs",
          label: "no → MVP only (bounded)",
          cls: "warn",
        },
        {
          from: "stage2",
          to: "stage3",
          label: "system-ready spec → build contract",
          cls: "strong",
        },
        {
          from: "tokens",
          to: "stage3",
          label: "token contract",
          cls: "strong",
        },
        {
          from: "stage3",
          to: "authoring",
          label: "generate tag manifest",
          cls: "",
        },
        {
          from: "stage3",
          to: "outputs",
          label: "ship: Milo + Storybook + docs",
          cls: "strong",
        },
        {
          from: "authoring",
          to: "outputs",
          label: "Sidekick selection → correct variant",
          cls: "",
        },

        // Feedback loops
        {
          from: "outputs",
          to: "stage2",
          label: "adoption feedback / new needs",
          cls: "dashed",
        },
        {
          from: "outputs",
          to: "tokens",
          label: "token gaps / new semantics",
          cls: "dashed",
        },
      ];

      // -----------------------------
      // Rendering helpers
      // -----------------------------
      const svg = d3.select("#svg");
      const inner = d3.select("#g");
      const render = new dagreD3.render();

      const panel = d3.select("#panel");
      const panelTitle = d3.select("#panelTitle");
      const panelSubtitle = d3.select("#panelSubtitle");

      const viewTitle = d3.select("#viewTitle");
      const viewSub = d3.select("#viewSub");

      let currentView = "org"; // org | lifecycle
      let currentGraph = null;
      let currentNodes = null;

      const zoom = d3
        .zoom()
        .scaleExtent([0.5, 1.4])
        .on("zoom", (event) => {
          inner.attr("transform", event.transform);
        });

      svg.call(zoom);

      function setPanel(key) {
        const r = currentNodes[key];
        if (!r) return;

        panelTitle.text(r.title);
        panelSubtitle.text(
          "Responsibilities + how this node leverages AI/MCP/automation in the ecosystem.",
        );
        panel.html("");

        panel.append("h3").text(r.title);

        const pills = panel.append("div").attr("class", "pillRow");
        (r.pills || []).forEach((p, idx) => {
          const cls =
            idx === 0 ? "pill accent" : idx === 1 ? "pill good" : "pill warn";
          pills.append("span").attr("class", cls).text(p);
        });

        const s1 = panel.append("div").attr("class", "section");
        s1.append("h4").text("Owns / Responsibilities");
        const ul1 = s1.append("ul");
        (r.owns || []).forEach((x) => ul1.append("li").text(x));

        const s2 = panel.append("div").attr("class", "section");
        s2.append("h4").text("Leverages AI / MCP / Agentic workflows");
        const ul2 = s2.append("ul");
        (r.leverages || []).forEach((x) => ul2.append("li").text(x));

        const s3 = panel.append("div").attr("class", "section");
        s3.append("h4").text("Key outputs / artifacts");
        const ul3 = s3.append("ul");
        (r.outputs || []).forEach((x) => ul3.append("li").text(x));
      }

      function clearSelection() {
        inner.selectAll("g.node").classed("selected", false);
      }

      function centerView(g) {
        const graphWidth = g.graph().width;
        const graphHeight = g.graph().height;
        const svgWidth = svg.node().clientWidth;
        const svgHeight = svg.node().clientHeight;

        const scale = 0.92;
        const translateX = (svgWidth - graphWidth * scale) / 2;
        const translateY = 28;

        svg
          .transition()
          .duration(350)
          .call(
            zoom.transform,
            d3.zoomIdentity.translate(translateX, translateY).scale(scale),
          );
      }

      function buildGraph(nodes, edges, opts) {
        const g = new dagreD3.graphlib.Graph({ multigraph: true })
          .setGraph({
            rankdir: opts.rankdir || "TB",
            nodesep: opts.nodesep ?? 45,
            ranksep: opts.ranksep ?? 65,
            marginx: 20,
            marginy: 20,
          })
          .setDefaultEdgeLabel(() => ({}));

        // Node style: highlight important nodes per view
        const nodeStyle = (key) => {
          const base =
            "fill: rgba(255,255,255,0.03); stroke: rgba(255,255,255,0.16); stroke-width: 1.3px;";
          if (opts.primary && opts.primary.includes(key)) {
            return base + " stroke: rgba(96,165,250,0.85); stroke-width: 2px;";
          }
          return base;
        };

        Object.entries(nodes).forEach(([key, r]) => {
          g.setNode(key, {
            label: r.title,
            rx: 12,
            ry: 12,
            padding: 14,
            style: nodeStyle(key),
          });
        });

        edges.forEach((e, i) => {
          g.setEdge(
            e.from,
            e.to,
            {
              label: e.label,
              lineInterpolate: "basis",
              class: e.cls || "",
              arrowhead: "vee",
            },
            `e${i}`,
          );
        });

        return g;
      }

      function renderView(view) {
        clearSelection();
        inner.selectAll("*").remove();

        if (view === "org") {
          currentView = "org";
          currentNodes = orgNodes;
          viewTitle.text("North Star Team Org + Agentic Workflow");
          viewSub.text(
            "Roles, relationships, and how AI/MCP/automation is leveraged.",
          );

          currentGraph = buildGraph(orgNodes, orgEdges, {
            rankdir: "TB",
            primary: ["architect"],
          });
          render(inner, currentGraph);

          // default selection
          setPanel("architect");
          inner
            .selectAll("g.node")
            .filter((d) => d === "architect")
            .classed("selected", true);
        } else {
          currentView = "lifecycle";
          currentNodes = lifeNodes;
          viewTitle.text(
            "Product Lifecycle / Workflow (MVP → Scaling → System Spec/Build)",
          );
          viewSub.text(
            "How redesign work graduates into a scalable Consonant/Milo system (with gates + outputs).",
          );

          currentGraph = buildGraph(lifeNodes, lifeEdges, {
            rankdir: "LR",
            primary: ["stage3", "tokens"],
          });
          render(inner, currentGraph);

          setPanel("stage1");
          inner
            .selectAll("g.node")
            .filter((d) => d === "stage1")
            .classed("selected", true);
        }

        // Node click
        inner
          .selectAll("g.node")
          .style("cursor", "pointer")
          .on("click", function (event, key) {
            clearSelection();
            d3.select(this).classed("selected", true);
            setPanel(key);
          });

        // Improve edge label visibility
        inner.selectAll("g.edgeLabel").attr("opacity", 0.88);

        // Center
        centerView(currentGraph);
      }

      // Buttons
      d3.select("#btnCenter").on("click", () => centerView(currentGraph));
      d3.select("#btnReset").on("click", () => {
        clearSelection();
        panelTitle.text("Details");
        panelSubtitle.text("Select a node in the diagram.");
        panel.html("");
        // restore sensible defaults per view
        if (currentView === "org") {
          setPanel("architect");
          inner
            .selectAll("g.node")
            .filter((d) => d === "architect")
            .classed("selected", true);
        } else {
          setPanel("stage1");
          inner
            .selectAll("g.node")
            .filter((d) => d === "stage1")
            .classed("selected", true);
        }
        centerView(currentGraph);
      });

      // Tabs
      const tabOrg = d3.select("#tabOrg");
      const tabLife = d3.select("#tabLifecycle");

      function setActiveTab(which) {
        tabOrg.classed("active", which === "org");
        tabLife.classed("active", which === "lifecycle");
      }

      tabOrg.on("click", () => {
        setActiveTab("org");
        renderView("org");
      });
      tabLife.on("click", () => {
        setActiveTab("lifecycle");
        renderView("lifecycle");
      });

      // Initial render
      renderView("org");

      // Panel toggle
      const rightPanel = d3.select("#rightPanel");
      const wrap = d3.select(".wrap");
      const toggleBtn = d3.select("#togglePanel");
      
      function updateToggleButton() {
        const isCollapsed = rightPanel.classed("collapsed");
        toggleBtn.text(isCollapsed ? "Show Panel" : "Hide Panel");
        toggleBtn.attr("title", isCollapsed ? "Show panel" : "Hide panel");
      }
      
      toggleBtn.on("click", () => {
        const isCollapsed = rightPanel.classed("collapsed");
        rightPanel.classed("collapsed", !isCollapsed);
        wrap.classed("right-collapsed", !isCollapsed);
        updateToggleButton();
      });
      
      // Initialize button text
      updateToggleButton();
    </script>
  </body>
</html>
